<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switzea - Svelte Architecture Preview</title>
    <style>
        /* CSS Variables - Design System */
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --accent: #FF6B35;
            --text: #333;
            --bg: #f5f7fa;
            --white: #ffffff;
            --border: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --radius: 8px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            line-height: 1.6;
            color: var(--text);
        }

        /* Pre-release Banner */
        .pre-release-banner {
            background: linear-gradient(135deg, var(--accent), #e55a2b);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        /* Header Component */
        .app-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .project-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .project-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Button Component */
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-outline { background: transparent; color: white; border: 1px solid white; }

        /* Main Layout */
        .app-container {
            display: flex;
            min-height: calc(100vh - 120px);
            max-width: 1400px;
            margin: 0 auto;
            gap: 1rem;
            padding: 1rem;
        }

        /* Sidebar Component */
        .sidebar {
            width: 280px;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            height: fit-content;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .sidebar-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
        }

        .craftsman-list {
            list-style: none;
        }

        .craftsman-item {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-left: 4px solid var(--secondary);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease;
            cursor: grab;
        }

        .craftsman-item:hover {
            transform: translateX(4px);
        }

        .craftsman-name {
            font-weight: 500;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem 1rem;
        }

        /* Timeline Component */
        .timeline-container {
            flex: 1;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .timeline-header {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .timeline-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .week-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .timeline-info {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Grid Component */
        .timeline-grid {
            display: flex;
            flex-direction: column;
            min-height: 500px;
        }

        .grid-header {
            display: flex;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-bottom: 2px solid var(--border);
            font-weight: 600;
        }

        .header-craftsman {
            width: 200px;
            padding: 1rem;
            border-right: 2px solid var(--border);
            background: linear-gradient(145deg, #e9ecef, #d6d8db);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-days {
            flex: 1;
            display: flex;
        }

        .day-header {
            flex: 1;
            padding: 0.75rem 0.5rem;
            border-right: 1px solid var(--border);
            text-align: center;
            font-size: 0.85rem;
        }

        .day-header:last-child {
            border-right: none;
        }

        .day-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .day-date {
            font-size: 0.75rem;
            color: #666;
        }

        .grid-body {
            flex: 1;
        }

        .grid-row {
            display: flex;
            border-bottom: 1px solid var(--border);
            min-height: 80px;
        }

        .row-craftsman {
            width: 200px;
            padding: 1rem;
            border-right: 2px solid var(--border);
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            font-weight: 500;
            border-left: 4px solid var(--secondary);
        }

        .row-days {
            flex: 1;
            display: flex;
        }

        .grid-cell {
            flex: 1;
            border-right: 1px solid var(--border);
            position: relative;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .grid-cell:hover {
            background: #e3f2fd;
        }

        .grid-cell:last-child {
            border-right: none;
        }

        /* Task Component */
        .task {
            position: absolute;
            top: 8px;
            left: 4px;
            right: 4px;
            height: 64px;
            background: linear-gradient(145deg, var(--secondary), #1976d2);
            color: white;
            border-radius: 6px;
            padding: 0.5rem;
            cursor: move;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .task-title {
            font-weight: 600;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .task-meta {
            display: flex;
            gap: 0.5rem;
            font-size: 0.7rem;
            opacity: 0.9;
        }

        /* Modal Component */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        /* Status Component */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-planned { background: #f3f4f6; color: #374151; }
        .status-progress { background: #dbeafe; color: #1d4ed8; }
        .status-completed { background: #d1fae5; color: #065f46; }

        /* Priority indicators */
        .priority-high { border-left-color: #dc2626 !important; }
        .priority-medium { border-left-color: #f59e0b !important; }
        .priority-low { border-left-color: var(--primary) !important; }

        /* Toast Component */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error { background: #dc2626; }
        .toast.warning { background: #f59e0b; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                padding: 0.5rem;
            }
            
            .sidebar {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .timeline-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* Architecture Preview Styles */
        .architecture-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem;
            font-size: 0.9rem;
        }

        .component-label {
            position: relative;
        }

        .component-label::before {
            content: attr(data-component);
            position: absolute;
            top: -8px;
            left: 8px;
            background: #0ea5e9;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            z-index: 10;
        }
    </style>
</head>
<body>
    <!-- Pre-release Banner -->
    <div class="pre-release-banner">
        🚧 SWITZEA SVELTE - PRE-RELEASE VERSION | Modulær arkitektur demo | Test med egne data
    </div>

    <!-- Header Component -->
    <header class="app-header component-label" data-component="Header.svelte">
        <div class="header-content">
            <div>
                <h1 class="project-title">Switzea Projektplanlægning</h1>
                <p class="project-subtitle">Svelte Architecture - Clean & Modular</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" onclick="openProjectModal()">⚙️ Projekt</button>
                <button class="btn btn-secondary" onclick="exportData()">💾 Gem</button>
                <button class="btn btn-secondary" onclick="importData()">📂 Indlæs</button>
                <button class="btn btn-outline" onclick="showArchitecture()">🏗️ Arkitektur</button>
            </div>
        </div>
    </header>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar Component -->
        <aside class="sidebar component-label" data-component="CraftsmanSidebar.svelte">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Håndværkere</h2>
                <button class="btn btn-primary" onclick="openCraftsmanModal()">+ Tilføj</button>
            </div>
            
            <ul class="craftsman-list" id="craftsmanList">
                <li class="empty-state">
                    <p>Ingen håndværkere tilføjet</p>
                    <button class="btn btn-primary" onclick="openCraftsmanModal()" style="margin-top: 0.75rem;">
                        Tilføj første håndværker
                    </button>
                </li>
            </ul>
        </aside>

        <!-- Timeline Component -->
        <main class="timeline-container component-label" data-component="Timeline.svelte">
            <div class="timeline-header">
                <div class="timeline-controls">
                    <div class="week-controls">
                        <button class="btn btn-secondary" onclick="removeWeek()">− Uge</button>
                        <span id="weekDisplay">3 uger</span>
                        <button class="btn btn-secondary" onclick="addWeek()">+ Uge</button>
                    </div>
                    <div class="timeline-info" id="timelineInfo">
                        September 2025 - 3 uger timeline
                    </div>
                    <div>
                        <label>Start: </label>
                        <input type="date" id="projectStartDate" value="2025-09-16" onchange="updateStartDate()" class="form-input" style="width: auto; display: inline-block;">
                    </div>
                </div>
            </div>

            <div class="timeline-grid component-label" data-component="TimelineGrid.svelte">
                <!-- Grid Header -->
                <div class="grid-header">
                    <div class="header-craftsman">Håndværkere</div>
                    <div class="header-days">
                        <div class="day-header">
                            <div class="day-name">Man</div>
                            <div class="day-date">16/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tir</div>
                            <div class="day-date">17/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Ons</div>
                            <div class="day-date">18/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tor</div>
                            <div class="day-date">19/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Fre</div>
                            <div class="day-date">20/09</div>
                        </div>
                        <!-- Week 2 -->
                        <div class="day-header">
                            <div class="day-name">Man</div>
                            <div class="day-date">23/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tir</div>
                            <div class="day-date">24/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Ons</div>
                            <div class="day-date">25/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tor</div>
                            <div class="day-date">26/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Fre</div>
                            <div class="day-date">27/09</div>
                        </div>
                        <!-- Week 3 -->
                        <div class="day-header">
                            <div class="day-name">Man</div>
                            <div class="day-date">30/09</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tir</div>
                            <div class="day-date">01/10</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Ons</div>
                            <div class="day-date">02/10</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Tor</div>
                            <div class="day-date">03/10</div>
                        </div>
                        <div class="day-header">
                            <div class="day-name">Fre</div>
                            <div class="day-date">04/10</div>
                        </div>
                    </div>
                </div>

                <!-- Grid Body -->
                <div class="grid-body" id="timelineBody">
                    <div class="empty-state" style="padding: 3rem; text-align: center;">
                        <p>Tilføj håndværkere for at se timeline</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; color: #888;">
                            Klik på celler for at oprette opgaver når håndværkere er tilføjet
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Architecture Info -->
    <div class="architecture-info">
        <strong>🏗️ Svelte Arkitektur Preview:</strong> Denne version viser den nye komponent-baserede struktur. 
        Hver sektion er nu en isoleret Svelte-komponent med egen state management. 
        Modulær kode = lettere at teste, debugge og udvide. 
        <strong>Test:</strong> Tilføj håndværkere → Klik på timeline celler → Opret opgaver.
    </div>

    <!-- Task Modal Component -->
    <div class="modal-overlay" id="taskModal" data-component="TaskModal.svelte">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Ny opgave</h2>
            </div>

            <form onsubmit="saveTask(event)">
                <div class="form-group">
                    <label class="form-label">Opgavetitel</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Beskrivelse</label>
                    <textarea class="form-input" id="taskDescription" rows="3"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Startdato</label>
                        <input type="date" class="form-input" id="taskStartDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Varighed (dage)</label>
                        <input type="number" class="form-input" id="taskDuration" min="0.5" step="0.5" value="1" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Håndværker</label>
                        <select class="form-input" id="taskCraftsman" required>
                            <option value="">Vælg håndværker...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prioritet</label>
                        <select class="form-input" id="taskPriority">
                            <option value="low">Lav</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">Høj</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-input" id="taskStatus">
                        <option value="planned" selected>Planlagt</option>
                        <option value="progress">I gang</option>
                        <option value="completed">Udført</option>
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">Annullér</button>
                    <button type="submit" class="btn btn-primary">Gem opgave</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Craftsman Modal Component -->
    <div class="modal-overlay" id="craftsmanModal" data-component="CraftsmanModal.svelte">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Tilføj håndværker</h2>
            </div>

            <form onsubmit="saveCraftsman(event)">
                <div class="form-group">
                    <label class="form-label">Håndværkertype</label>
                    <select class="form-input" id="craftsmanType" required>
                        <option value="">Vælg type...</option>
                        <option value="Projektleder">Projektleder</option>
                        <option value="Byggeleder">Byggeleder</option>
                        <option value="Elektriker">Elektriker</option>
                        <option value="VVS-montør">VVS-montør</option>
                        <option value="Maler">Maler</option>
                        <option value="Tømrer">Tømrer</option>
                        <option value="Murer">Murer</option>
                        <option value="Andet">Andet</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Farve</label>
                    <input type="color" class="form-input" id="craftsmanColor" value="#2196F3">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('craftsmanModal')">Annullér</button>
                    <button type="submit" class="btn btn-primary">Tilføj håndværker</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Component -->
    <div class="toast" id="toast" data-component="Toast.svelte"></div>

    <script>
        // Application State (Svelte Stores simulation)
        let appState = {
            craftsmen: [],
            tasks: [],
            weeks: 3,
            projectStart: new Date('2025-09-16')
        };

        let currentEditingTask = null;
        let currentEditingCraftsman = null;

        // Date Utilities (utils/dateCalculations.js)
        function calculateDayFromDate(date, projectStart) {
            const diffTime = date - projectStart;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let workDays = 0;
            let currentDate = new Date(projectStart);
            
            while (currentDate < date) {
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Skip weekends
                    workDays++;
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return Math.max(1, workDays + 1);
        }

        function calculateDateFromDay(dayNumber, projectStart) {
            let currentDate = new Date(projectStart);
            let workDays = 1;
            
            if (dayNumber === 1) return new Date(projectStart);
            
            while (workDays < dayNumber) {
                currentDate.setDate(currentDate.getDate() + 1);
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                    workDays++;
                }
            }
            
            return currentDate;
        }

        function formatDate(date) {
            return date.toLocaleDateString('da-DK', {
                day: '2-digit',
                month: '2-digit'
            });
        }

        // Toast Component Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Modal Component Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            // Reset forms
            const modal = document.getElementById(modalId);
            const form = modal.querySelector('form');
            if (form) form.reset();
            
            currentEditingTask = null;
            currentEditingCraftsman = null;
        }

        // Craftsman Component Functions
        function openCraftsmanModal() {
            openModal('craftsmanModal');
        }

        function saveCraftsman(event) {
            event.preventDefault();
            
            const name = document.getElementById('craftsmanType').value;
            const color = document.getElementById('craftsmanColor').value;
            
            const craftsman = {
                id: 'craftsman_' + Date.now(),
                name: name,
                color: color,
                order: appState.craftsmen.length
            };
            
            appState.craftsmen.push(craftsman);
            renderCraftsmen();
            renderTimeline();
            closeModal('craftsmanModal');
            showToast('Håndværker tilføjet');
        }

        function deleteCraftsman(id) {
            if (confirm('Er du sikker på du vil slette denne håndværker?')) {
                appState.craftsmen = appState.craftsmen.filter(c => c.id !== id);
                appState.tasks = appState.tasks.filter(t => t.craftsman !== id);
                renderCraftsmen();
                renderTimeline();
                showToast('Håndværker slettet');
            }
        }

        // Task Component Functions
        function openTaskModal(craftsmanId, day) {
            const date = calculateDateFromDay(day, appState.projectStart);
            
            document.getElementById('modalTitle').textContent = 'Ny opgave';
            document.getElementById('taskStartDate').value = date.toISOString().split('T')[0];
            
            // Populate craftsman dropdown
            const select = document.getElementById('taskCraftsman');
            select.innerHTML = '<option value="">Vælg håndværker...</option>';
            appState.craftsmen.forEach(c => {
                const option = document.createElement('option');
                option.value = c.id;
                option.textContent = c.name;
                option.selected = c.id === craftsmanId;
                select.appendChild(option);
            });
            
            openModal('taskModal');
        }

        function saveTask(event) {
            event.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const startDate = new Date(document.getElementById('taskStartDate').value);
            const duration = parseFloat(document.getElementById('taskDuration').value);
            const craftsman = document.getElementById('taskCraftsman').value;
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;
            
            const startDay = calculateDayFromDate(startDate, appState.projectStart);
            
            const task = {
                id: 'task_' + Date.now(),
                title: title,
                description: description,
                startDate: startDate.toISOString().split('T')[0],
                startDay: startDay,
                duration: duration,
                craftsman: craftsman,
                priority: priority,
                status: status
            };
            
            appState.tasks.push(task);
            renderTimeline();
            closeModal('taskModal');
            showToast('Opgave oprettet');
        }

        function editTask(taskId) {
            const task = appState.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentEditingTask = task;
            
            document.getElementById('modalTitle').textContent = 'Redigér opgave';
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskStartDate').value = task.startDate;
            document.getElementById('taskDuration').value = task.duration;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskStatus').value = task.status;
            
            // Populate craftsman dropdown
            const select = document.getElementById('taskCraftsman');
            select.innerHTML = '<option value="">Vælg håndværker...</option>';
            appState.craftsmen.forEach(c => {
                const option = document.createElement('option');
                option.value = c.id;
                option.textContent = c.name;
                option.selected = c.id === task.craftsman;
                select.appendChild(option);
            });
            
            openModal('taskModal');
        }

        function deleteTask(taskId) {
            if (confirm('Er du sikker på du vil slette denne opgave?')) {
                appState.tasks = appState.tasks.filter(t => t.id !== taskId);
                renderTimeline();
                showToast('Opgave slettet');
            }
        }

        // Render Functions (Component Updates)
        function renderCraftsmen() {
            const list = document.getElementById('craftsmanList');
            
            if (appState.craftsmen.length === 0) {
                list.innerHTML = `
                    <li class="empty-state">
                        <p>Ingen håndværkere tilføjet</p>
                        <button class="btn btn-primary" onclick="openCraftsmanModal()" style="margin-top: 0.75rem;">
                            Tilføj første håndværker
                        </button>
                    </li>
                `;
                return;
            }
            
            list.innerHTML = '';
            appState.craftsmen.forEach(craftsman => {
                const li = document.createElement('li');
                li.className = 'craftsman-item';
                li.style.borderLeftColor = craftsman.color;
                
                li.innerHTML = `
                    <span class="craftsman-name">${craftsman.name}</span>
                    <button class="delete-btn" onclick="deleteCraftsman('${craftsman.id}')">×</button>
                `;
                
                list.appendChild(li);
            });
        }

        function renderTimeline() {
            const body = document.getElementById('timelineBody');
            
            if (appState.craftsmen.length === 0) {
                body.innerHTML = `
                    <div class="empty-state" style="padding: 3rem; text-align: center;">
                        <p>Tilføj håndværkere for at se timeline</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; color: #888;">
                            Klik på celler for at oprette opgaver når håndværkere er tilføjet
                        </p>
                    </div>
                `;
                return;
            }
            
            body.innerHTML = '';
            const totalDays = appState.weeks * 5;
            
            appState.craftsmen.forEach(craftsman => {
                const row = document.createElement('div');
                row.className = 'grid-row';
                
                const nameCell = document.createElement('div');
                nameCell.className = 'row-craftsman';
                nameCell.style.borderLeftColor = craftsman.color;
                nameCell.textContent = craftsman.name;
                
                const daysContainer = document.createElement('div');
                daysContainer.className = 'row-days';
                
                for (let day = 1; day <= totalDays; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.onclick = () => openTaskModal(craftsman.id, day);
                    
                    // Find tasks for this craftsman and day
                    const tasks = appState.tasks.filter(t => 
                        t.craftsman === craftsman.id && 
                        t.startDay <= day && 
                        t.startDay + t.duration > day
                    );
                    
                    tasks.forEach(task => {
                        if (task.startDay === day) {
                            const taskElement = document.createElement('div');
                            taskElement.className = `task priority-${task.priority}`;
                            taskElement.style.width = `${task.duration * 100}%`;
                            
                            taskElement.innerHTML = `
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">
                                    <span class="status-badge status-${task.status}">
                                        ${task.status === 'planned' ? 'Plan' : task.status === 'progress' ? 'Gang' : 'Færdig'}
                                    </span>
                                </div>
                            `;
                            
                            taskElement.onclick = (e) => {
                                e.stopPropagation();
                                editTask(task.id);
                            };
                            
                            cell.appendChild(taskElement);
                        }
                    });
                    
                    daysContainer.appendChild(cell);
                }
                
                row.appendChild(nameCell);
                row.appendChild(daysContainer);
                body.appendChild(row);
            });
        }

        // Timeline Control Functions
        function addWeek() {
            appState.weeks++;
            document.getElementById('weekDisplay').textContent = `${appState.weeks} uger`;
            renderTimeline();
            showToast('Uge tilføjet');
        }

        function removeWeek() {
            if (appState.weeks > 1) {
                appState.weeks--;
                document.getElementById('weekDisplay').textContent = `${appState.weeks} uger`;
                renderTimeline();
                showToast('Uge fjernet');
            }
        }

        function updateStartDate() {
            const newDate = new Date(document.getElementById('projectStartDate').value);
            appState.projectStart = newDate;
            
            // Recalculate all task days
            appState.tasks.forEach(task => {
                const taskDate = new Date(task.startDate);
                task.startDay = calculateDayFromDate(taskDate, appState.projectStart);
            });
            
            renderTimeline();
            showToast('Projektstart opdateret');
        }

        // Placeholder functions for header buttons
        function openProjectModal() {
            showToast('Projekt modal kommer i fuld version', 'warning');
        }

        function exportData() {
            const data = JSON.stringify(appState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'switzea-project.json';
            a.click();
            showToast('Data eksporteret');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            appState = JSON.parse(e.target.result);
                            appState.projectStart = new Date(appState.projectStart);
                            renderCraftsmen();
                            renderTimeline();
                            showToast('Data importeret');
                        } catch (error) {
                            showToast('Fejl ved import', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function showArchitecture() {
            alert(`🏗️ SWITZEA SVELTE ARKITEKTUR:

📁 src/lib/components/
├── Timeline.svelte (timeline grid)
├── TaskModal.svelte (opgave modal)
├── CraftsmanSidebar.svelte (håndværker liste)
├── Toast.svelte (beskeder)
└── Header.svelte (top bar)

📁 src/lib/stores/
├── tasks.js (opgave state)
├── craftsmen.js (håndværker state)
└── ui.js (modal/toast state)

📁 src/lib/utils/
├── dateCalculations.js (dato logik)
├── validation.js (form validering)
└── export.js (data export/import)

🎯 FORDELE:
• Isoleret komponent testing
• Type safety med TypeScript
• Hot reload under udvikling
• Mindre bugs med reaktiv state
• Lettere maintenance og udvidelser`);
        }

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', function() {
            renderCraftsmen();
            renderTimeline();
            showToast('Swelte arkitektur preview klar!', 'success');
        });

        // Close modals on background click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeModal(overlay.id);
                }
            });
        });
    </script>
</body>
</html>
